var area = {
    "相模湾海底": "사가미 만 해저",
    "北海道地方": "홋카이도 지방",
    "東北地方": "도호쿠 지방",
    "北陸地方": "호쿠리쿠 지방",
    "関東甲信地方": "간토 지방",
    "小笠原地方": "오가사와라 지방",
    "東海地方": "토카이 지방",
    "近畿地方": "킨키 지방",
    "中国地方": "츄고쿠 지방",
    "四国地方": "시고쿠 지방",
    "九州地方": "큐슈 지방",
    "沖縄地方": "오키나와 지방",
    "石狩地方北部": "이시카리 지방 북부",
    "石狩地方中部": "이시카리 지방 중부",
    "石狩地方南部": "이시카리 지방 남부",
    "渡島地方北部": "오시마 지방 북부",
    "渡島地方東部": "오시마 지방 동부",
    "渡島地方西部": "오시마 지방 서부",
    "檜山地方": "히야마 지방",
    "後志地方北部": "시리베시 지방 북부",
    "後志地方東部": "시리베시 지방 동부",
    "後志地方西部": "시리베시 지방 서부",
    "北海道奥尻島": "홋카이도 오쿠시리섬",
    "空知地方北部": "소라치 지방 북부",
    "空知地方中部": "소라치 지방 중부",
    "空知地方南部": "소라치 지방 남부",
    "上川地方北部": "카미카와 지방 북부",
    "上川地方中部": "카미카와 지방 중부",
    "上川地方南部": "카미카와 지방 남부",
    "留萌地方中北部": "루모이 지방 중북부",
    "留萌地方南部": "루모이 지방 남부",
    "宗谷地方北部": "소야 지방 북부",
    "宗谷地方南部": "소야 지방 남부",
    "北海道利尻礼文": "홋카이도 리시리 레븐섬",
    "網走地方": "아바시리 지방",
    "北見地方": "키타미 지방",
    "紋別地方": "몬베스 지방",
    "胆振地方西部": "이부리 지방 서부",
    "胆振地方中東部": "이부리 지방 중동부",
    "日高地方西部": "히다카 지방 서부",
    "日高地方中部": "히다카 지방 중부",
    "日高地方東部": "히다카 지방 동부",
    "十勝地方北部": "토카치 지방 북부",
    "十勝地方中部": "토카치 지방 중부",
    "十勝地方南部": "토카치 지방 남부",
    "釧路地方北部": "쿠시로 지방 북부",
    "釧路地方中南部": "쿠시로 지방 중남부",
    "根室地方北部": "네무로 지방 북부",
    "根室地方中部": "네무로 지방 중부",
    "根室地方南部": "네무로 지방 남부",
    "北海道南西沖": "홋카이도 남서해",
    "北海道西方沖": "홋카이도 서방 바다",
    "石狩湾": "이시카리 만",
    "北海道北西沖": "홋카이도 북서해",
    "宗谷海峡": "소야 해협",
    "国後島付近": "쿠나시르 섬 부근",
    "択捉島付近": "에토로후 섬 부근",
    "北海道東方沖": "홋카이도 동방바다",
    "根室半島南東沖": "네무로 반도 남동해",
    "釧路沖": "쿠시로 앞바다",
    "十勝沖": "토카치 앞바다",
    "浦河沖": "우라카와 앞바다",
    "苫小牧沖": "토마코미아 앞바다",
    "内浦湾": "우치우라 만",
    "宗谷東方沖": "소야 동방바다",
    "網走沖": "아바시리 앞바다",
    "択捉島南東沖": "에토로후 섬 남동해",
    "青森県津軽北部": "아오모리 현 쓰가루 북부",
    "青森県津軽南部": "아오모리 현 쓰가루 남부",
    "青森県三八上北地方": "아오모리 현 삼파치카미키타",
    "青森県下北地方": "아오모리 현 시모키타",
    "岩手県沿岸北部": "이와테 현 연안 북부",
    "岩手県沿岸南部": "이와테 현 연안 남부",
    "岩手県内陸北部": "이와테 현 내륙 북부",
    "岩手県内陸南部": "이와테 현 내륙 남부",
    "宮城県北部": "미야기 현 북부",
    "宮城県南部": "미야기 현 남부",
    "宮城県中部": "미야기 현 중부",
    "秋田県沿岸北部": "아키타 현 연안 북부",
    "秋田県沿岸南部": "아키타 현 연안 남부",
    "秋田県内陸北部": "아키타 현 내륙 북부",
    "秋田県内陸南部": "아키타 현 내륙 남부",
    "山形県庄内地方": "야마가타 현 쇼나이 지방",
    "山形県最上地方": "야마가타 현 모가미 지방",
    "山形県村山地方": "야마가타 현 무라야마 지방",
    "山形県置賜地方": "야마가타 현 오키타마 지방",
    "福島県中通り": "후쿠시마 현 나카도리",
    "福島県浜通り": "후쿠시마 현 하마도리",
    "福島県会津": "후쿠시마 현 아이즈",
    "津軽海峡": "쓰가루 해협",
    "山形県沖": "야마사타 현 앞바다",
    "秋田県沖": "아키타 현 앞바다",
    "青森県西方沖": "아오모리 현 서방바다",
    "陸奥湾": "무쓰 만",
    "青森県東方沖": "아오모리 현 동방바다",
    "岩手県沖": "이와테 현 앞바다",
    "宮城県沖": "미야기 현 앞바다",
    "三陸沖": "산리쿠 해",
    "福島県沖": "후쿠시마 현 앞바다",
    "茨城県北部": "이바라키 현 북부",
    "茨城県南部": "이바라키 현 남부",
    "千葉県南東沖": "치바 현 남동해",
    "栃木県北部": "토치기 현 북부",
    "栃木県南部": "토치기 현 남부",
    "群馬県北部": "군마 현 북부",
    "群馬県南部": "군마 현 남부",
    "埼玉県北部": "사이타마 현 북부",
    "埼玉県南部": "사이타마 현 남부",
    "埼玉県秩父地方": "사이타마 현 지치부",
    "千葉県北東部": "치바 현 북동부",
    "千葉県北西部": "치바 현 북서부",
    "千葉県南部": "치바 현 남부",
    "房総半島南方沖": "보소반도 남방바다",
    "東京都２３区": "도쿄도 23구",
    "東京都多摩東部": "도쿄도 다마 동부",
    "東京都多摩西部": "도쿄도 다마 서부",
    "神津島": "코즈섬",
    "伊豆大島": "이즈오섬",
    "新島": "니이섬",
    "三宅島": "미야케섬",
    "八丈島": "하치조섬",
    "小笠原": "오가사와라섬",
    "神奈川県東部": "카나가와 현 동부",
    "神奈川県西部": "카나가와 현 서부",
    "新潟県上越地方": "니가타 현 조에쓰 지방",
    "新潟県中越地方": "니가타 현 주에쓰 지방",
    "新潟県下越地方": "니가타 현 카에쓰 지방",
    "新潟県佐渡": "니가타 현 사도",
    "新潟県下越沖": "니가타 현 카에쓰 앞바다",
    "新潟県上中越沖": "니가타 현 조오추에쓰 앞바다",
    "富山県東部": "토야마 현 동부",
    "富山県西部": "토야마 현 서부",
    "石川県能登地方": "이시카와 현 노토 지방",
    "石川県加賀地方": "이시카와 현 가카 지방",
    "福井県嶺北": "후쿠이 현 레에호쿠",
    "福井県嶺南": "후쿠이 현 레에난",
    "山梨県中・西部": "야마나시 현 중・서부",
    "山梨県東部・富士五湖": "야마나시 현 동부・후지 5호",
    "長野県北部": "나가노 현 북부",
    "長野県中部": "나가노 현 중부",
    "長野県南部": "나가노 현 남부",
    "岐阜県飛騨地方": "기후 현 히다지방",
    "岐阜県美濃東部": "기후 현 미노 동부",
    "岐阜県美濃中西部": "기후 현 미노 중서부",
    "静岡県伊豆地方": "시즈오카 현 이즈지방",
    "静岡県東部": "시즈오카 현 동부",
    "静岡県中部": "시즈오카 현 중부",
    "静岡県西部": "시즈오카 현 서부",
    "愛知県東部": "아이치 현 동부",
    "愛知県西部": "아이치 현 서부",
    "三重県北部": "미에 현 북부",
    "三重県中部": "미에 현 중부",
    "三重県南部": "미에 현 남부",
    "三重県南東沖": "미에 현 남동해",
    "茨城県沖": "이바라키 현 앞바다",
    "関東東方沖": "칸토 동방바다",
    "千葉県東方沖": "치바 현 동방바다",
    "八丈島東方沖": "하치조 섬 동방바다",
    "八丈島近海": "하치조 섬 근해",
    "東京湾": "도쿄 만",
    "相模湾": "사가미 만",
    "伊豆大島近海": "이즈오 섬 근해",
    "伊豆半島東方沖": "이즈 반도 동방바다",
    "三宅島近海": "미야케 섬 근해",
    "新島・神津島近海": "니이 섬・코즈 섬 근해",
    "駿河湾": "스루가 만",
    "駿河湾南方沖": "스루가 만 남방바다",
    "遠州灘": "엔슈나다",
    "三河湾": "미카와 만",
    "伊勢湾": "이세 만",
    "若狭湾": "와카사 만",
    "福井県沖": "후쿠이 현 앞바다",
    "石川県西方沖": "이시카와 현 서방바다",
    "能登半島沖": "노토 반도 앞바다",
    "富山湾": "토야마 만",
    "佐渡付近": "사도 부근",
    "東海道南方沖": "도카이도 남방바다",
    "滋賀県北部": "시가 현 북부",
    "滋賀県南部": "시가 현 남부",
    "京都府北部": "교토 부 북부",
    "京都府南部": "교토 부 남부",
    "大阪府北部": "오사카 부 북부",
    "大阪府南部": "오사카 부 남부",
    "兵庫県北部": "효고 현 북부",
    "兵庫県南東部": "효고 현 남동부",
    "兵庫県南西部": "효고 현 남서부",
    "兵庫県淡路島": "효고 현 이와지섬",
    "奈良県": "나라 현",
    "和歌山県北部": "와카야마 현 북부",
    "和歌山県南部": "와카야마 현 남부",
    "鳥取県東部": "돗토리 현 동부",
    "鳥取県中部": "돗토리 현 중부",
    "鳥取県西部": "돗토리 현 남부",
    "島根県東部": "시마네 현 동부",
    "島根県西部": "시마네 현 남부",
    "島根県隠岐": "시마네 현 오키",
    "岡山県北部": "오카야마 현 북부",
    "岡山県南部": "오카야마 현 남부",
    "広島県北部": "히로시마 현 북부",
    "広島県南東部": "히로시마 현 남동부",
    "広島県南西部": "히로시마 현 남서부",
    "徳島県北部": "도쿠시마 현 북부",
    "徳島県南部": "도쿠시마 현 남부",
    "香川県東部": "가가와 현 동부",
    "香川県西部": "가가와 현 서부",
    "愛媛県東予": "에히메 현 도요",
    "愛媛県中予": "에히메 현 주요",
    "愛媛県南予": "에히메 현 난요",
    "高知県東部": "고치 현 동부",
    "高知県中部": "고치 현 중부",
    "高知県西部": "고치 현 서부",
    "土佐湾": "토사만",
    "紀伊水道": "기이수도",
    "大阪湾": "오사카만",
    "播磨灘": "하리마 나다",
    "瀬戸内海中部": "세토 내해 중부",
    "安芸灘": "아키 나다",
    "周防灘": "스오 나다",
    "伊予灘": "이요 나다",
    "豊後水道": "분고 수도",
    "山口県北西沖": "야마구치 현 북서해",
    "島根県沖": "시마네 현 앞바다",
    "鳥取県沖": "돗토리 현 앞바다",
    "隠岐島近海": "오키 섬 근해",
    "兵庫県北方沖": "효고 현 북방 바다",
    "京都府沖": "교토 부 앞바다",
    "淡路島付近": "아와지 섬 근해",
    "和歌山県南方沖": "와카야마 현 남방 바다",
    "山口県北部": "야마구치 현 북부",
    "山口県西部": "야마구치 현 서부",
    "山口県東部": "야마구치 현 동부",
    "山口県中部": "야마구치 현 중부",
    "福岡県福岡地方": "후쿠오카 현 후쿠오카 지방",
    "福岡県北九州地方": "후쿠오카 현 키타규슈 지방",
    "福岡県筑豊地方": "후쿠오카 현 치쿠호 지방",
    "福岡県筑後地方": "후쿠오카 현 치쿠고 지방",
    "佐賀県北部": "사가 현 북부",
    "佐賀県南部": "사가 현 남부",
    "長崎県北部": "나가사키 현 북부",
    "長崎県南西部": "나가사키 현 남서부",
    "長崎県島原半島": "나가사키 현 시마바라 반도",
    "長崎県対馬": "나가사키 현 쓰시마섬",
    "長崎県壱岐": "나가사키 현 이키섬",
    "長崎県五島": "나가사키 현 고토섬",
    "熊本県阿蘇地方": "구마모토 현 아소",
    "熊本県熊本地方": "구마모토 현 구마모토 지방",
    "熊本県球磨地方": "구마모토 현 쿠마 지방",
    "熊本県天草・芦北地方": "구마모토 현 아마쿠사・아시키타 지방",
    "大分県北部": "오이타 현 북부",
    "大分県中部": "오이타 현 중부",
    "大分県南部": "오이타 현 남부",
    "大分県西部": "오이타 현 서부",
    "宮崎県北部平野部": "미야자키 현 북부 평야부",
    "宮崎県北部山沿い": "미야자키 현 북부 산기슭",
    "宮崎県南部平野部": "미야자키 현 남부 평야부",
    "宮崎県南部山沿い": "미야자키 현 남부 산기슭",
    "鹿児島県薩摩地方": "가고시마 현 사쓰마 지방",
    "鹿児島県大隅地方": "가고시마 현 오스미 지방",
    "鹿児島県十島村": "가고시마 현 토시마무라",
    "鹿児島県甑島": "가고시마 현 고시키섬",
    "鹿児島県種子島": "가고시마 현 다네가섬",
    "鹿児島県屋久島": "가고시마 현 야쿠섬",
    "鹿児島県奄美北部": "가고시마 현 아마미북부",
    "鹿児島県奄美南部": "가고시마 현 아마미남부",
    "五島列島近海": "고토 열도 근해",
    "天草灘": "야마쿠사 나다",
    "有明海": "아리아케 해",
    "橘湾": "타치바나 만",
    "鹿児島湾": "가고시마 만",
    "種子島近海": "다네가시마 근해",
    "日向灘": "휴가 나다",
    "奄美大島近海": "아마미오 섬 근해",
    "壱岐・対馬近海": "이키・쓰시마 근해",
    "福岡県北西沖": "후쿠오카 현 북서 해",
    "薩摩半島西方沖": "사쓰마반도 서방바다",
    "トカラ列島近海": "토카라 열도 근해",
    "奄美大島北西沖": "아마미오 섬 북서해",
    "沖縄県本島北部": "오키나와 현 본섬 북부",
    "沖縄県本島中南部": "오키나와 현 본섬 중남부",
    "沖縄県久米島": "오키나와 현 구메섬",
    "沖縄県宮古島": "오키나와 현 미야코섬",
    "沖縄県石垣島": "오키나와 현 이시가키섬",
    "沖縄県与那国島": "오키나와 현 요나쿠니섬",
    "沖縄県西表島": "오키나와 현 이리오모테섬",
    "大隅半島東方沖": "오스미반도 동방바다",
    "九州地方南東沖": "규슈 지방 남동해",
    "種子島南東沖": "다네가 섬 남동해",
    "奄美大島北東沖": "아마미오 섬 북동해",
    "沖縄本島近海": "오키나와 본섬 근해",
    "南大東島近海": "미나미다이토 섬 근해",
    "沖縄本島南方沖": "오키나와 본섬 남방바다",
    "宮古島近海": "미야코지마 근해",
    "石垣島近海": "이시가키 섬 근해",
    "石垣島南方沖": "이시가키 섬 남방바다",
    "西表島付近": "이리오모테 섬 부근",
    "与那国島近海": "요나구니 섬 근해",
    "沖縄本島北西沖": "오키나와 본섬 북동해",
    "宮古島北西沖": "미야코 섬 북서해",
    "石垣島北西沖": "이시가키 섬 북서해",
    "台湾付近": "대만 부근",
    "東シナ海": "동중국해",
    "四国沖": "시고쿠 해",
    "鳥島近海": "도리시마 섬 근해",
    "鳥島東方沖": "도리시마 섬 동방바다",
    "オホーツク海南部": "오호츠크 해 남부",
    "サハリン西方沖": "사할린 서방 바다",
    "日本海北部": "동해 북부",
    "日本海中部": "동해 중부",
    "日本海西部": "동해 서부",
    "父島近海": "치치 섬 근해",
    "千島列島": "쿠릴 열도",
    "千島列島南東沖": "쿠릴 열도 남동해",
    "北海道南東沖": "홋카이도 남동해",
    "東北地方東方沖": "도호쿠 지방 동방바다",
    "小笠原諸島西方沖": "오가사와라 제도 서방바다",
    "硫黄島近海": "이오 섬 근해",
    "小笠原諸島東方沖": "오가사와라 제도 동방바다",
    "南海道南方沖": "난카이도 동방 바다",
    "薩南諸島東方沖": "사쓰난 섬 동방 바다",
    "本州南方沖": "혼슈 남방바다",
    "サハリン南部付近": "사할린 남부 부근",
    "北西太平洋": "북서 태평양",
    "マリアナ諸島": "마리아나 제도",
    "黄海": "황해",
    "朝鮮半島南部": "한반도 남부",
    "朝鮮半島北部": "한반도 북부",
    "中国東北部": "중국 동북부",
    "ウラジオストク付近": "블라디보스토크 부근",
    "シベリア南部": "시베리아 남부",
    "サハリン近海": "사할린 근해",
    "アリューシャン列島": "알류산 열도",
    "カムチャツカ半島付近": "캄챠카 반도 부근",
    "北米西部": "북미 서부",
    "北米中部": "북미 중부",
    "北米東部": "북미 동부",
    "中米": "미국",
    "南米西部": "남미 서부",
    "南米中部": "남미 중부",
    "南米東部": "남미 동부",
    "北東太平洋": "북동 태평양",
    "南太平洋": "남태평양",
    "インドシナ半島付近": "인도 차이나 반도 부근",
    "フィリピン付近": "필리핀 부근",
    "インドネシア付近": "인도네시아 부근",
    "グアム付近": "괌 부근",
    "ニューギニア付近": "뉴기니 섬 부근",
    "ニュージーランド付近": "뉴질랜드 부근",
    "オーストラリア付近": "호주 부근",
    "シベリア付近": "시베리아 부근",
    "ロシア西部": "러시아 서부",
    "ロシア中部": "러시아 중부",
    "ロシア東部": "러시아 동부",
    "中央アジア": "중앙 아시아",
    "中国西部": "중국 서부",
    "中国中部": "중국 중부",
    "中国東部": "중국 동부",
    "インド付近": "인도 부근",
    "インド洋": "인도양",
    "中東": "중동",
    "ヨーロッパ西部": "유럽 서부",
    "ヨーロッパ中部": "유럽 중부",
    "ヨーロッパ東部": "유럽 동부",
    "地中海": "지중해",
    "アフリカ西部": "아프리카 서부",
    "アフリカ中部": "아프리카 중부",
    "アフリカ東部": "아프리카 동부",
    "北大西洋": "북대서양",
    "南大西洋": "남대서양",
    "北極付近": "북극 부근",
    "南極付近": "남극 부근",
    "遠地": "원지"
}
function areakr(value) {
    for (var key in area) {
        if (key === value) {
            return area[key];
        }
    }
    return value;
}
function removeSpaces(inputString) {
    return inputString.replace(/\s/g, '');
}
const map = L.map('map').setView([37.5, 137.5], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
}).addTo(map);

var circles = [];
function mapping() {
    // 입력을 라인별로 분할
    var input = document.getElementById('data').value
    const lines = input.trim().split('\n');
    const earthquakeData = [];
    var jsonData = ''
    lines.forEach(line => {
        var year = line.slice(0, 4)
        var month = line.slice(5, 7)
        var day = line.slice(8, 10)
        var hour = line.slice(11, 16)
        var second = line.slice(17, 21)
        var lat = line.slice(22, 32)
        var lon = line.slice(33, 43)
        var depth = line.slice(45, 48)
        var magnitude = line.slice(52, 56)
        var name = line.slice(58,)
        const formattedData = {
            time: `${year}-${month}-${day} ${hour}:${second}`,
            lat: lat,
            lon: lon,
            dep: parseFloat(depth),
            mag: parseFloat(magnitude),
            name: name,
        };

        if (year) {
            earthquakeData.push(formattedData);
        }
    });

    jsonData = JSON.stringify(earthquakeData, null, 2);

    jsonData = JSON.parse(jsonData);

    function convertCoordinate(coord) {
        const [degrees, minutes] = coord.replace(/\s/g, '').split(/[^\d\w.]+/);

        const integerPart = parseInt(degrees, 10);
        const decimalPart = parseFloat(minutes) / 60;

        const result = integerPart + decimalPart;
        return result;
    }
    const interpolateColor20 = d3.interpolateHslLong("red", "orange");
    const interpolateColor50 = d3.interpolateHslLong("orange", "yellow");
    const interpolateColor100 = d3.interpolateHslLong("yellow", "green");
    const interpolateColor1000 = d3.interpolateHslLong("green", "blue");

    jsonData.forEach(data => {
        var radius
        if (data.mag < 0.5) {
            radius = 100
        } else {
            radius = ((data.mag * 30) ** 2);
        }
        var fillColor
        if (data.dep < 20) {
            const depthScale = d3.scaleLinear().domain([0, 20]).range([0, 1]);
            fillColor = interpolateColor20(depthScale(data.dep));
        } else if (data.dep < 50) {
            const depthScale = d3.scaleLinear().domain([20, 50]).range([0, 1]);
            fillColor = interpolateColor50(depthScale(data.dep));
        } else if (data.depth < 100) {
            const depthScale = d3.scaleLinear().domain([50, 100]).range([0, 1]);
            fillColor = interpolateColor100(depthScale(data.dep));
        } else {
            const depthScale = d3.scaleLinear().domain([100, 700]).range([0, 1]);
            fillColor = interpolateColor1000(depthScale(data.dep));
        }
        if (data.mag == null) {
            data.mag = '불명'
        }

        const circle = L.circle([convertCoordinate(data.lat), convertCoordinate(data.lon)], {
            radius: radius,
            color: fillColor,
            fillColor: fillColor,
            fillOpacity: 0.4
        }).addTo(map)
            .bindPopup(`<b>${areakr(removeSpaces(data.name))}</b><br>규모: ${data.mag}<br>깊이: ${data.dep}km<br>발생시각: ${data.time}`).openPopup();
        circles.push(circle)
    });
}
function removeCircles() {
    // 배열에 저장된 모든 원을 맵에서 제거
    circles.forEach(circle => {
        map.removeLayer(circle);
    });
    circles=[]

}
document.getElementById('go').addEventListener('click', function(){
    removeCircles()
    document.getElementById('alert_text').textContent = '초기화 후, 지도에 매핑하는중'
    document.getElementById('alert').style = 'display:block;'
    setTimeout(function () {
        mapping()
        document.getElementById('setting_box').style = 'display:none'
        document.getElementById('alert_text').textContent = '매핑완료'
        document.getElementById('alert').style = 'display:none;'
    }, 1000)
})
document.getElementById('setting').addEventListener('click', function(){
    document.getElementById('setting_box').style = 'display:block'
})
document.getElementById('close_set').addEventListener('click', function(){
    document.getElementById('setting_box').style = 'display:none'
})